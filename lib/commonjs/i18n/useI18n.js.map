{"version":3,"sources":["useI18n.js"],"names":["cache","useI18n","moduleName","loader","I18nContext","intl","state","moduleKey","locale","cachedModule","Runtime","log","messages","others","messagesWithId","key","msg","id","defaultMessage","loading","value","t","identity","intlMessages","messageId","vars","formatMessage"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAMA,KAAK,GAAG,EAAd;AAEA;AACA;AACA;AACA;AACA;;AACe,SAASC,OAAT,CAAiBC,UAAjB,EAA6B;AACxC,QAAM;AAAEC,IAAAA;AAAF,MAAa,uBAAWC,yBAAX,CAAnB;AACA,QAAMC,IAAI,GAAG,yBAAb;AAEA,QAAMC,KAAK,GAAG,2BAAa,YAAY;AACnC,QAAIJ,UAAJ,EAAgB;AACZ,YAAMK,SAAS,aAAMF,IAAI,CAACG,MAAX,cAAqBN,UAArB,CAAf;AAEA,YAAMO,YAAY,GAAGT,KAAK,CAACO,SAAD,CAA1B;;AACA,UAAIE,YAAJ,EAAkB;AACdC,yBAAQC,GAAR,CACI,SADJ,EAEI,mCAA2BJ,SAA3B,mBAFJ;;AAIA,eAAOE,YAAP;AACH;;AAED,YAAM;AAAEG,QAAAA,QAAF;AAAY,WAAGC;AAAf,UAA0B,MAAMV,MAAM,CACxCE,IAAI,CAACG,MADmC,EAExCN,UAFwC,CAA5C;AAIA,YAAMY,cAAc,GAAG,EAAvB;;AAEA,WAAK,IAAIC,GAAT,IAAgBH,QAAhB,EAA0B;AACtB,cAAMI,GAAG,GAAGJ,QAAQ,CAACG,GAAD,CAApB;AACA,cAAME,EAAE,aAAMf,UAAN,cAAoBa,GAApB,CAAR;AAEAD,QAAAA,cAAc,CAACC,GAAD,CAAd,GACI,OAAOC,GAAP,KAAe,QAAf,GACM;AACIC,UAAAA,EADJ;AAEIC,UAAAA,cAAc,EAAEF;AAFpB,SADN,GAKM,EACI,GAAGA,GADP;AAEIC,UAAAA;AAFJ,SANV;AAUH;;AAED,aAAQjB,KAAK,CAACO,SAAD,CAAL,GAAmB,EACvB,GAAGM,MADoB;AAEvBE,QAAAA,GAAG,EAAER,SAFkB;AAGvBK,QAAAA,QAAQ,EAAE,+BAAeE,cAAf;AAHa,OAA3B;AAKH;;AAED,WAAO,IAAP;AACH,GA3Ca,EA2CX,CAACX,MAAD,EAASE,IAAI,CAACG,MAAd,EAAsBN,UAAtB,CA3CW,CAAd;;AA6CA,MAAII,KAAK,CAACa,OAAN,IAAiBb,KAAK,CAACc,KAAN,IAAe,IAApC,EAA0C;AACtC,WAAO,EACH,GAAGd,KADA;AAEHD,MAAAA,IAFG;AAGHgB,MAAAA,CAAC,EAAEC;AAHA,KAAP;AAKH;;AAED,QAAMC,YAAY,GAAGjB,KAAK,CAACc,KAAN,CAAYR,QAAjC;AAEA,SAAO;AACHO,IAAAA,OAAO,EAAE,KADN;AAEHd,IAAAA,IAFG;AAGHgB,IAAAA,CAAC,EAAE,CAACG,SAAD,EAAYC,IAAZ,KACCF,YAAY,CAACC,SAAD,CAAZ,IAA2B,IAA3B,GACM,0BAAYA,SAAZ,CADN,GAEMnB,IAAI,CAACqB,aAAL,CAAmBH,YAAY,CAACC,SAAD,CAA/B,EAA4CC,IAA5C;AANP,GAAP;AAQH","sourcesContent":["import { useContext } from 'react';\nimport { useIntl, defineMessages } from 'react-intl';\n\nimport Runtime from '../Runtime';\nimport useAsyncMemo from '../hooks/useAsyncMemo';\nimport { identity } from '../utils/callback';\nimport { I18nContext } from './I18nProvider';\nimport passThrough from './passThrough';\n\n/**\n * Features:\n *  Lazy locale loading, better performance for web app\n *  Messages grouped by modules\n *\n * @see {@link https://formatjs.io/guides/message-syntax/} for message syntax\n */\n\nconst cache = {};\n\n/**\n * Returns a translator { t = (text, variables) => <translated and injected text> } of specified locale module.\n * @param {string} [moduleName]\n * @returns {Object} { loading, t }\n */\nexport default function useI18n(moduleName) {\n    const { loader } = useContext(I18nContext);\n    const intl = useIntl();\n\n    const state = useAsyncMemo(async () => {\n        if (moduleName) {\n            const moduleKey = `${intl.locale}/${moduleName}`;\n\n            const cachedModule = cache[moduleKey];\n            if (cachedModule) {\n                Runtime.log(\n                    'verbose',\n                    () => `Load locale data \"${moduleKey}\" from cache.`\n                );\n                return cachedModule;\n            }\n\n            const { messages, ...others } = await loader(\n                intl.locale,\n                moduleName\n            );\n            const messagesWithId = {};\n\n            for (let key in messages) {\n                const msg = messages[key];\n                const id = `${moduleName}.${key}`;\n\n                messagesWithId[key] =\n                    typeof msg === 'string'\n                        ? {\n                              id,\n                              defaultMessage: msg,\n                          }\n                        : {\n                              ...msg,\n                              id,\n                          };\n            }\n\n            return (cache[moduleKey] = {\n                ...others,\n                key: moduleKey,\n                messages: defineMessages(messagesWithId),\n            });\n        }\n\n        return null;\n    }, [loader, intl.locale, moduleName]);\n\n    if (state.loading || state.value == null) {\n        return {\n            ...state,\n            intl,\n            t: identity,\n        };\n    }\n\n    const intlMessages = state.value.messages;\n\n    return {\n        loading: false,\n        intl,\n        t: (messageId, vars) =>\n            intlMessages[messageId] == null\n                ? passThrough(messageId)\n                : intl.formatMessage(intlMessages[messageId], vars),\n    };\n}\n"]}