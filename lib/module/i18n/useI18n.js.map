{"version":3,"sources":["useI18n.js"],"names":["useContext","useIntl","defineMessages","useAsyncMemo","identity","I18nContext","passThrough","useI18n","moduleName","loader","cache","intl","moduleKey","locale","state","cachedModule","localeData","messages","key","msg","defaultMessage","id","loading","value","t","intlMessages","messageId","vars","formatMessage"],"mappings":"AAAA,SAASA,UAAT,QAA2B,OAA3B;AACA,SAASC,OAAT,EAAkBC,cAAlB,QAAwC,YAAxC;AACA,OAAOC,YAAP,MAAyB,uBAAzB;AACA,SAASC,QAAT,QAAyB,mBAAzB;AACA,SAASC,WAAT,QAA4B,gBAA5B;AACA,OAAOC,WAAP,MAAwB,eAAxB;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AACA,eAAe,SAASC,OAAT,CAAiBC,UAAjB,EAA6B;AACxC,QAAM;AAAEC,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAoBV,UAAU,CAACK,WAAD,CAApC;AACA,QAAMM,IAAI,GAAGV,OAAO,EAApB;AAEA,QAAMW,SAAS,aAAMD,IAAI,CAACE,MAAX,cAAqBL,UAArB,CAAf;AAEA,QAAMM,KAAK,GAAGX,YAAY,CAAC,YAAY;AACnC,UAAMY,YAAY,GAAGL,KAAK,CAACE,SAAD,CAA1B;;AACA,QAAIG,YAAJ,EAAkB;AACd,aAAOA,YAAP;AACH;;AAED,UAAMC,UAAU,GAAG,MAAMP,MAAM,CAACE,IAAI,CAACE,MAAN,EAAcL,UAAd,CAA/B;AAEA,UAAMS,QAAQ,GAAG,EAAjB;;AAEA,SAAK,IAAIC,GAAT,IAAgBF,UAAU,CAACC,QAA3B,EAAqC;AACjC,UAAIE,GAAG,GAAGH,UAAU,CAACC,QAAX,CAAoBC,GAApB,CAAV;;AACA,UAAI,OAAOC,GAAP,KAAe,QAAnB,EAA6B;AACzBA,QAAAA,GAAG,GAAG;AACFC,UAAAA,cAAc,EAAED;AADd,SAAN;AAGH;;AACDF,MAAAA,QAAQ,CAACC,GAAD,CAAR,GAAgB;AACZG,QAAAA,EAAE,EAAEb,UAAU,GAAG,GAAb,GAAmBU,GADX;AAEZ,WAAGC;AAFS,OAAhB;AAIH;;AAED,WAAQT,KAAK,CAACE,SAAD,CAAL,GAAmB,EACvB,GAAGI,UADoB;AAEvBC,MAAAA,QAAQ,EAAEf,cAAc,CAACe,QAAD;AAFD,KAA3B;AAIH,GA3ByB,EA2BvB,CAACR,MAAD,EAASE,IAAI,CAACE,MAAd,EAAsBL,UAAtB,CA3BuB,CAA1B;;AA6BA,MAAIM,KAAK,CAACQ,OAAN,IAAiBR,KAAK,CAACS,KAAN,IAAe,IAApC,EAA0C;AACtC,WAAO,EACH,GAAGT,KADA;AAEHU,MAAAA,CAAC,EAAEpB;AAFA,KAAP;AAIH;;AAED,QAAMqB,YAAY,GAAGX,KAAK,CAACS,KAAN,CAAYN,QAAjC;AAEA,SAAO;AACHK,IAAAA,OAAO,EAAE,KADN;AAEHE,IAAAA,CAAC,EAAE,CAACE,SAAD,EAAYC,IAAZ,KACCF,YAAY,CAACC,SAAD,CAAZ,IAA2B,IAA3B,GACMpB,WAAW,CAACoB,SAAD,CADjB,GAEMf,IAAI,CAACiB,aAAL,CAAmBH,YAAY,CAACC,SAAD,CAA/B,EAA4CC,IAA5C;AALP,GAAP;AAOH","sourcesContent":["import { useContext } from 'react';\nimport { useIntl, defineMessages } from 'react-intl';\nimport useAsyncMemo from '../hooks/useAsyncMemo';\nimport { identity } from '../utils/callback';\nimport { I18nContext } from './I18nProvider';\nimport passThrough from './passThrough';\n\n/**\n * @see {@link https://formatjs.io/guides/message-syntax/} for message syntax\n */\n\n/**\n * Returns a translator { t = (text, variables) => <translated and injected text> } of specified locale module.\n * @param {string} [moduleName]\n * @returns {Object} { loading, t }\n */\nexport default function useI18n(moduleName) {\n    const { loader, cache } = useContext(I18nContext);\n    const intl = useIntl();\n\n    const moduleKey = `${intl.locale}/${moduleName}`;\n\n    const state = useAsyncMemo(async () => {\n        const cachedModule = cache[moduleKey];\n        if (cachedModule) {\n            return cachedModule;\n        }\n\n        const localeData = await loader(intl.locale, moduleName);\n\n        const messages = {};\n\n        for (let key in localeData.messages) {\n            let msg = localeData.messages[key];\n            if (typeof msg === 'string') {\n                msg = {\n                    defaultMessage: msg,\n                };\n            }\n            messages[key] = {\n                id: moduleName + '.' + key,\n                ...msg,\n            };\n        }\n\n        return (cache[moduleKey] = {\n            ...localeData,\n            messages: defineMessages(messages),\n        });\n    }, [loader, intl.locale, moduleName]);\n\n    if (state.loading || state.value == null) {\n        return {\n            ...state,\n            t: identity,\n        };\n    }\n\n    const intlMessages = state.value.messages;\n\n    return {\n        loading: false,\n        t: (messageId, vars) =>\n            intlMessages[messageId] == null\n                ? passThrough(messageId)\n                : intl.formatMessage(intlMessages[messageId], vars),\n    };\n}\n"]}