{"version":3,"sources":["useI18n.js"],"names":["useContext","useIntl","defineMessages","Runtime","useAsyncMemo","identity","I18nContext","passThrough","cache","registerLocale","locale","moduleName","loadedModule","messages","others","messagesWithId","key","msg","id","defaultMessage","moduleKey","useI18n","loader","intl","state","cachedModule","log","loading","value","t","intlMessages","messageId","vars","formatMessage"],"mappings":"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","sourcesContent":["import { useContext } from 'react';\nimport { useIntl, defineMessages } from 'react-intl';\n\nimport Runtime from '../Runtime';\nimport useAsyncMemo from '../hooks/useAsyncMemo';\nimport { identity } from '../utils/callback';\nimport { I18nContext } from './I18nProvider';\nimport passThrough from './passThrough';\n\n/**\n * Features:\n *  Lazy locale loading, better performance for web app\n *  Messages grouped by modules\n *\n * @see {@link https://formatjs.io/guides/message-syntax/} for message syntax\n */\n\nconst cache = {};\n\n/**\n * Register a preloaded locale module\n * @param {*} loader\n * @param {*} locale\n * @param {*} moduleName\n */\nexport const registerLocale = (locale, moduleName, loadedModule) => {\n    const { messages, ...others } = loadedModule;\n    const messagesWithId = {};\n\n    for (let key in messages) {\n        const msg = messages[key];\n        const id = `${moduleName}.${key}`;\n\n        //todo: be replaced with pre-compiled locale data\n        messagesWithId[key] =\n            typeof msg === 'string'\n                ? {\n                      id,\n                      defaultMessage: msg,\n                  }\n                : {\n                      ...msg,\n                      id,\n                  };\n    }\n\n    const moduleKey = `${locale}/${moduleName}`;\n\n    return (cache[moduleKey] = {\n        ...others,\n        key: moduleKey,\n        messages: defineMessages(messagesWithId),\n    });\n};\n\n/**\n * Returns a translator { t = (text, variables) => <translated and injected text> } of specified locale module.\n * @param {string} [moduleName]\n * @returns {Object} { loading, t }\n */\nexport default function useI18n(moduleName) {\n    const { loader } = useContext(I18nContext);\n    const intl = useIntl();\n\n    const state = useAsyncMemo(async () => {\n        if (moduleName) {\n            const moduleKey = `${intl.locale}/${moduleName}`;\n\n            const cachedModule = cache[moduleKey];\n            if (cachedModule) {\n                Runtime.log(\n                    'verbose',\n                    () => `Load locale data \"${moduleKey}\" from cache.`\n                );\n                return cachedModule;\n            }\n\n            return (\n                loader &&\n                registerLocale(\n                    intl.locale,\n                    moduleName,\n                    await loader(intl.locale, moduleName)\n                )\n            );\n        }\n\n        return null;\n    }, [loader, intl.locale, moduleName]);\n\n    if (state.loading || state.value == null) {\n        return {\n            ...state,\n            intl,\n            t: identity,\n        };\n    }\n\n    const intlMessages = state.value.messages;\n\n    return {\n        loading: false,\n        intl,\n        t: (messageId, vars) =>\n            intlMessages[messageId] == null\n                ? passThrough(messageId)\n                : intl.formatMessage(intlMessages[messageId], vars),\n    };\n}\n"]}